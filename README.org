* Encrypted repo setup

#+BEGIN_SRC sh
  export BORG_PASSCOMMAND="security -q find-generic-password -l 'borgmatic version1' -w"
  borg init --encryption=keyfile-blake2 <PATH>
  borg config <PATH> additional_free_space 2G
  borg config <PATH> max_segment_size 240M # needed for Box.com uploads
#+END_SRC



list the temp directory

#+BEGIN_SRC bash :results output
    umount ~/1st_temp/ || true

    mount -t smbfs //bishbr@icdwpcoredfs01.peroot.com/Share/1st%20Temp ~/1st_temp
    ls -ld ~/1st_temp/bishbr
#+END_SRC

#+RESULTS:
: drwx------+ 1 bishbr PEROOT\Domain Users 16384 Feb 11 10:52 /Users/bishbr/1st_temp/bishbr

1st_temp borg repo create

#+BEGIN_SRC sh :results output
  umount ~/1st_temp/ || true

  mount -t smbfs //bishbr@icdwpcoredfs01.peroot.com/Share/1st%20Temp ~/1st_temp
  mkdir -p ~/1st_temp/bishbr

  export BORG_PASSCOMMAND="security -q find-generic-password -l 'borgmatic version1' -w"
  borg init --progress --verbose --encryption=keyfile-blake2 ~/1st_temp/bishbr/borg
  umount ~/1st_temp
#+END_SRC


#+RESULTS:

* Keyfile export to USB drive

#+BEGIN_SRC sh
borg key export ~/box/borg-encrypted /Volumes/sandisk/Artifacts/borg-encrypted.key
#+END_SRC

#+RESULTS:

* Release locking

Had to nuke some lock files after several failed backups

#+BEGIN_SRC sh :results output
rm -f /Volumes/Redsandisk/borgmatic/lock.exclusive/*
rm -f /Volumes/Sandisk/borgmatic/lock.exclusive/*
rm -f ~/box/borgmatic/lock.exclusive/*
rm -f ~/.cache/borg/*
#+END_SRC

#+RESULTS:

* TODO update the borg executable on the external devices
borg's out of date on the USB disks



 